<!DOCTYPE html>
<html>
<head>
  <title>Tolstojs Game Genie code converter</title>
  <script>
    function handleInput() {
      var input = document.getElementById("hexInput").value.replace(/[-x\s]/gi, "").toUpperCase();
      
      // only allow 6 digits or 9 digits hex values
      if (/^[0-9A-Fa-f]{6}$/.test(input) || /^[0-9A-Fa-f]{9}$/.test(input)) {
        var A = parseInt(input.charAt(0), 16).toString(16);
        var B = parseInt(input.charAt(1), 16).toString(16);
        var C = parseInt(input.charAt(2), 16).toString(16);
        var D = parseInt(input.charAt(3), 16).toString(16);
        var E = parseInt(input.charAt(4), 16).toString(16);
        var F = (0xF - parseInt(input.charAt(5), 16)).toString(16);
        var G = parseInt(input.charAt(6), 16).toString(2).padStart(4, '0');
        var G2 = "";
        var H = "";
        var HInv = "";
        var GInv = "";

        if(input.length == 9){
          G2 = parseInt(input.charAt(7), 16).toString(2).padStart(4, '0');
          H = parseInt(input.charAt(8), 16).toString(2).padStart(4, '0');
        }

        var Gl = G.length;
        var G2l = G2.length;
        var Hl = H.length;

        // check if G = G2 but with the first digit flipped
      
        for(i=0; i<Gl; i++){
          add = 1;
          if(G.charAt(i) == 1) add = 0;
          GInv += add;
        }

        for(i=0; i<Hl; i++){
            add = 1;
            if(H.charAt(i) == 1) add = 0;
            HInv += add;
        }

        var isSame = true;
        var i = 0;
        if (Gl === G2l) {
          while (isSame && i < Gl) {
            if (i === 0) {
              if (G.charAt(i) === G2.charAt(i)) {
                isSame = false;
              }
            } else {
              if (G.charAt(i) !== G2.charAt(i)) {
                isSame = false;
              }
            }
            i++;
          }
        }

        alert(G2 + " " + H);
        if(G2 == "" && H == ""){
          isSame = true;
        }

        if (isSame) {
          var hexAddress = F+C+D+E;
          var oldValue = HInv.charAt(2) + H.charAt(3) + GInv.charAt(0) + GInv.charAt(1) + GInv.charAt(2) + G.charAt(3) + HInv.charAt(0) + H.charAt(1);
          
          oldValue = parseInt(oldValue, 2).toString(16).padStart(2, '0');
          newValue = A + B;
          
          if(G2 == "" && H == ""){
            oldValue = "-";
          }

          document.getElementById("output").innerHTML = "Address: " + hexAddress + "<br>" + 
            "oldValue: " + oldValue + "<br>" +
            "newValue: " + newValue;
                                                            
        } else {
          alert("The Game Genie code failed a checksum test!");
        }
      } else {
        alert("This is not a Game Genie code!");
      }
  }
  </script>
</head>
<body>
  <h1>Game Genie Code</h1>
  <input type="text" id="hexInput" placeholder="eg. 145-F2E-C4E">
  <button onclick="handleInput()">Submit</button>
  <div id="output"></div>
</body>
</html>